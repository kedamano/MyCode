<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" 
      th:replace="~{layout/base :: layout(~{::title}, ~{::section})}">
<head>
    <meta charset="UTF-8">
    <title>农户统计分析 - 暖心助农选品平台</title>
    <script src="https://cdn.bootcdn.net/ajax/libs/echarts/5.4.2/echarts.min.js"></script>
</head>
<body>
    <section>
        <!-- 页面标题 -->
        <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center mb-4">
            <div>
                <h2 class="mb-1 d-flex align-items-center">
                    <i class="bi bi-people me-2 text-success"></i>农户统计分析
                </h2>
                <p class="text-muted mb-0">查看平台农户数据和分布情况</p>
            </div>
            
            <div class="d-flex mt-3 mt-md-0">
                <div class="btn-group">
                    <a th:href="@{/admin/statistics}" class="btn btn-outline-success">概览</a>
                    <a th:href="@{/admin/statistics/farmers}" class="btn btn-success active">农户分析</a>
                    <a th:href="@{/admin/statistics/products}" class="btn btn-outline-success">商品分析</a>
                </div>
            </div>
        </div>
        
        <!-- 数据卡片 -->
        <div class="row g-4 mb-4">
            <div class="col-md-6 col-lg-3">
                <div class="card h-100 border-0 shadow-sm">
                    <div class="card-body">
                        <div class="d-flex align-items-center mb-3">
                            <div class="bg-success bg-opacity-10 p-3 rounded-circle me-3">
                                <i class="bi bi-people text-success fs-4"></i>
                            </div>
                            <div>
                                <h6 class="mb-0 text-muted">农户总数</h6>
                                <h3 class="mb-0" th:text="${statistics.farmerCount}">0</h3>
                            </div>
                        </div>
                        <div class="progress" style="height: 6px;">
                            <div class="progress-bar bg-success" role="progressbar" style="width: 75%"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6 col-lg-3">
                <div class="card h-100 border-0 shadow-sm">
                    <div class="card-body">
                        <div class="d-flex align-items-center mb-3">
                            <div class="bg-warning bg-opacity-10 p-3 rounded-circle me-3">
                                <i class="bi bi-hourglass-split text-warning fs-4"></i>
                            </div>
                            <div>
                                <h6 class="mb-0 text-muted">待审核农户</h6>
                                <h3 class="mb-0" th:text="${statistics.pendingFarmerCount}">0</h3>
                            </div>
                        </div>
                        <div class="progress" style="height: 6px;">
                            <div class="progress-bar bg-warning" role="progressbar" style="width: 45%"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6 col-lg-3">
                <div class="card h-100 border-0 shadow-sm">
                    <div class="card-body">
                        <div class="d-flex align-items-center mb-3">
                            <div class="bg-primary bg-opacity-10 p-3 rounded-circle me-3">
                                <i class="bi bi-geo-alt text-primary fs-4"></i>
                            </div>
                            <div>
                                <h6 class="mb-0 text-muted">覆盖省份</h6>
                                <h3 class="mb-0" th:text="${#maps.size(statistics.farmersByProvince)}">0</h3>
                            </div>
                        </div>
                        <div class="progress" style="height: 6px;">
                            <div class="progress-bar bg-primary" role="progressbar" style="width: 65%"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6 col-lg-3">
                <div class="card h-100 border-0 shadow-sm">
                    <div class="card-body">
                        <div class="d-flex align-items-center mb-3">
                            <div class="bg-info bg-opacity-10 p-3 rounded-circle me-3">
                                <i class="bi bi-arrow-up-circle text-info fs-4"></i>
                            </div>
                            <div>
                                <h6 class="mb-0 text-muted">月增长率</h6>
                                <h3 class="mb-0">8.5%</h3>
                            </div>
                        </div>
                        <div class="progress" style="height: 6px;">
                            <div class="progress-bar bg-info" role="progressbar" style="width: 30%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 图表区域 -->
        <div class="row g-4">
            <!-- 农户区域分布 -->
            <div class="col-lg-6">
                <div class="card border-0 shadow-sm h-100">
                    <div class="card-header bg-white border-0 py-3">
                        <h5 class="mb-0">农户区域分布</h5>
                    </div>
                    <div class="card-body">
                        <div id="farmerProvinceChart" style="height: 400px;"></div>
                    </div>
                </div>
            </div>
            
            <!-- 农户增长趋势 -->
            <div class="col-lg-6">
                <div class="card border-0 shadow-sm h-100">
                    <div class="card-header bg-white border-0 py-3">
                        <h5 class="mb-0">农户增长趋势</h5>
                    </div>
                    <div class="card-body">
                        <div id="farmerGrowthChart" style="height: 400px;"></div>
                    </div>
                </div>
            </div>
            
            <!-- 农户区域表格 -->
            <div class="col-12">
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-white border-0 py-3">
                        <h5 class="mb-0">农户区域分布详情</h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>省份</th>
                                        <th>农户数量</th>
                                        <th>占比</th>
                                        <th>趋势</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr th:each="entry : ${statistics.farmersByProvince}">
                                        <td th:text="${entry.key}">省份</td>
                                        <td th:text="${entry.value}">数量</td>
                                        <td th:with="total=${statistics.farmerCount}, percentage=${entry.value * 100 / total}" 
                                            th:text="${#numbers.formatDecimal(percentage, 1, 2) + '%'}">占比</td>
                                        <td>
                                            <i class="bi bi-arrow-up-right text-success"></i>
                                            <span class="text-success">+5.2%</span>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 图表初始化脚本 -->
        <script th:inline="javascript">
            document.addEventListener('DOMContentLoaded', function() {
                // 获取统计数据
                const statistics = /*[[${statistics}]]*/ {};
                
                // 初始化农户区域分布图
                initFarmerProvinceChart(statistics.farmersByProvince || {});
                
                // 初始化农户增长趋势图
                initFarmerGrowthChart(statistics.farmersByMonth || {});
            });
            
            // 初始化农户区域分布图
            function initFarmerProvinceChart(data) {
                const chart = echarts.init(document.getElementById('farmerProvinceChart'));
                
                const provinces = Object.keys(data);
                const values = provinces.map(province => data[province]);
                
                const option = {
                    tooltip: {
                        trigger: 'item',
                        formatter: '{a} <br/>{b}: {c} ({d}%)'
                    },
                    legend: {
                        orient: 'vertical',
                        right: 10,
                        top: 'center',
                        data: provinces
                    },
                    color: ['#2ecc71', '#3498db', '#9b59b6', '#f1c40f', '#e67e22', '#95a5a6'],
                    series: [
                        {
                            name: '农户分布',
                            type: 'pie',
                            radius: ['40%', '70%'],
                            avoidLabelOverlap: false,
                            itemStyle: {
                                borderRadius: 10,
                                borderColor: '#fff',
                                borderWidth: 2
                            },
                            label: {
                                show: false,
                                position: 'center'
                            },
                            emphasis: {
                                label: {
                                    show: true,
                                    fontSize: '16',
                                    fontWeight: 'bold'
                                }
                            },
                            labelLine: {
                                show: false
                            },
                            data: provinces.map((province, index) => {
                                return {
                                    value: values[index],
                                    name: province
                                };
                            })
                        }
                    ]
                };
                
                chart.setOption(option);
                
                window.addEventListener('resize', function() {
                    chart.resize();
                });
            }
            
            // 初始化农户增长趋势图
            function initFarmerGrowthChart(data) {
                const chart = echarts.init(document.getElementById('farmerGrowthChart'));
                
                const months = Object.keys(data).sort();
                const values = months.map(month => data[month]);
                
                const option = {
                    tooltip: {
                        trigger: 'axis'
                    },
                    xAxis: {
                        type: 'category',
                        data: months,
                        axisLabel: {
                            formatter: function(value) {
                                return value.split('-')[1] + '月';
                            }
                        }
                    },
                    yAxis: {
                        type: 'value'
                    },
                    series: [
                        {
                            name: '新增农户',
                            data: values,
                            type: 'line',
                            smooth: true,
                            symbol: 'circle',
                            symbolSize: 8,
                            lineStyle: {
                                color: '#2ecc71',
                                width: 3
                            },
                            itemStyle: {
                                color: '#2ecc71'
                            },
                            areaStyle: {
                                color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                                    { offset: 0, color: 'rgba(46, 204, 113, 0.3)' },
                                    { offset: 1, color: 'rgba(46, 204, 113, 0.1)' }
                                ])
                            }
                        }
                    ]
                };
                
                chart.setOption(option);
                
                window.addEventListener('resize', function() {
                    chart.resize();
                });
            }
        </script>
    </section>
</body>
</html> 